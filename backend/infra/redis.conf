# Redis configuration for speech microservices
# Append-only file for persistence
appendonly yes
appendfilename "appendonly.aof"

# Optimize AOF for high-frequency writes
auto-aof-rewrite-percentage 50
auto-aof-rewrite-min-size 64mb
aof-rewrite-incremental-fsync yes

# Disable RDB snapshots (rely on AOF)
save ""

# Memory management
maxmemory 512mb
maxmemory-policy allkeys-lru

# Pub/Sub channel cleanup
notify-keyspace-events Ex

# Reduce memory fragmentation
active-defrag-ignore-bytes 100mb
active-defrag-threshold-lower 10
active-defrag-threshold-upper 100

# Logging
loglevel notice

# Disable protected mode for Docker
protected-mode no

# Bind to all interfaces for Docker networking
bind 0.0.0.0

# Stream configuration
stream-node-max-bytes 4096
stream-node-max-entries 100

# Timeout for inactive connections
timeout 300

# Enable active defragmentation
activedefrag yes

