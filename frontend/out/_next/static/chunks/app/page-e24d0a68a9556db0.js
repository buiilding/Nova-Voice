(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{2164:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>G});var i=s(5155),n=s(2115),a=s(9708),r=s(2085),l=s(2596),o=s(9688);function d(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,o.QP)((0,l.$)(t))}let c=(0,r.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function u(e){let{className:t,variant:s,size:n,asChild:r=!1,...l}=e,o=r?a.DX:"button";return(0,i.jsx)(o,{"data-slot":"button",className:d(c({variant:s,size:n,className:t})),...l})}var h=s(3500),g=s(583);function m(e){let{voiceTypingActive:t,liveSubtitleActive:s,onToggleVoiceTyping:n,onToggleLiveSubtitle:a}=e;return(0,i.jsxs)("div",{className:"flex items-center gap-1 flex-1 justify-start no-drag-region",children:[(0,i.jsxs)(u,{variant:"outline",size:"sm",className:"px-1.5 py-1 border-slate-600 text-slate-300 hover:bg-slate-700 bg-transparent relative transition-all duration-200 min-w-[90px] no-drag-region ".concat(t?"shadow-md shadow-blue-500/50 border-blue-400 text-blue-300 bg-blue-900/30":""),onClick:n,children:[(0,i.jsx)(h.A,{className:"w-2.5 h-2.5 mr-0.5"}),(0,i.jsx)("span",{className:"text-[10px]",children:"Voice Typing"}),(0,i.jsx)("span",{className:"text-slate-500 text-[8px] ml-0.5",children:"Win+Alt+V"}),t&&(0,i.jsx)("div",{className:"absolute -top-0.5 -right-0.5 w-1.5 h-1.5 bg-blue-400 rounded-full animate-pulse"})]}),(0,i.jsxs)(u,{variant:"outline",size:"sm",className:"px-1.5 py-1 border-slate-600 text-slate-300 hover:bg-slate-700 bg-transparent relative transition-all duration-200 min-w-[90px] ".concat(s?"shadow-md shadow-green-500/50 border-green-400 text-green-300 bg-green-900/30":""),onClick:a,children:[(0,i.jsx)(g.A,{className:"w-2.5 h-2.5 mr-0.5"}),(0,i.jsx)("span",{className:"text-[10px]",children:"Live Subtitle"}),(0,i.jsx)("span",{className:"text-slate-500 text-[8px] ml-0.5",children:"Win+Alt+L"}),s&&(0,i.jsx)("div",{className:"absolute -top-0.5 -right-0.5 w-1.5 h-1.5 bg-green-400 rounded-full animate-pulse"})]})]})}var x=s(707),p=s(6474),v=s(5196),f=s(7863);function b(e){let{...t}=e;return(0,i.jsx)(x.bL,{"data-slot":"select",...t})}function w(e){let{...t}=e;return(0,i.jsx)(x.WT,{"data-slot":"select-value",...t})}function y(e){let{className:t,size:s="default",children:n,...a}=e;return(0,i.jsxs)(x.l9,{"data-slot":"select-trigger","data-size":s,className:d("border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-fit items-center justify-between gap-2 rounded-md border bg-transparent px-3 py-2 text-sm whitespace-nowrap shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...a,children:[n,(0,i.jsx)(x.In,{asChild:!0,children:(0,i.jsx)(p.A,{className:"size-4 opacity-50"})})]})}function j(e){let{className:t,children:s,position:n="popper",...a}=e;return(0,i.jsx)(x.ZL,{children:(0,i.jsxs)(x.UC,{"data-slot":"select-content",className:d("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-md","popper"===n&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:n,...a,children:[(0,i.jsx)(A,{}),(0,i.jsx)(x.LM,{className:d("p-1","popper"===n&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1"),children:s}),(0,i.jsx)(k,{})]})})}function N(e){let{className:t,children:s,...n}=e;return(0,i.jsxs)(x.q7,{"data-slot":"select-item",className:d("focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",t),...n,children:[(0,i.jsx)("span",{className:"absolute right-2 flex size-3.5 items-center justify-center",children:(0,i.jsx)(x.VF,{children:(0,i.jsx)(v.A,{className:"size-4"})})}),(0,i.jsx)(x.p4,{children:s})]})}function A(e){let{className:t,...s}=e;return(0,i.jsx)(x.PP,{"data-slot":"select-scroll-up-button",className:d("flex cursor-default items-center justify-center py-1",t),...s,children:(0,i.jsx)(f.A,{className:"size-4"})})}function k(e){let{className:t,...s}=e;return(0,i.jsx)(x.wn,{"data-slot":"select-scroll-down-button",className:d("flex cursor-default items-center justify-center py-1",t),...s,children:(0,i.jsx)(p.A,{className:"size-4"})})}let S=[{value:"en",label:"EN"},{value:"es",label:"ES"},{value:"fr",label:"FR"},{value:"de",label:"DE"},{value:"vi",label:"VI"},{value:"zh",label:"ZH"},{value:"ja",label:"JA"},{value:"hi",label:"HI"}];function C(e){let{sourceLanguage:t,targetLanguage:s,onSourceLanguageChange:n,onTargetLanguageChange:a,openDropdown:r,setOpenDropdown:l,setPendingDropdown:o}=e;return(0,i.jsx)("div",{className:"flex items-center gap-2 flex-shrink-0 no-drag-region",children:(0,i.jsxs)("div",{className:"flex items-center gap-1",children:[(0,i.jsxs)(b,{value:t,onValueChange:n,open:"source"===r,onOpenChange:e=>{e?o("source"):(l(null),o(null))},children:[(0,i.jsx)(y,{className:"w-18 h-6 bg-slate-800/50 border-slate-600 text-white text-xs no-drag-region",children:(0,i.jsx)(w,{placeholder:"EN"})}),(0,i.jsx)(j,{className:"bg-slate-800 border-slate-600",children:S.map(e=>(0,i.jsx)(N,{value:e.value,className:"text-white hover:bg-slate-700 text-xs",children:e.label},e.value))})]}),(0,i.jsx)("span",{className:"text-slate-400 text-[10px]",children:"→"}),(0,i.jsxs)(b,{value:s,onValueChange:a,open:"target"===r,onOpenChange:e=>{e?o("target"):(l(null),o(null))},children:[(0,i.jsx)(y,{className:"w-18 h-6 bg-slate-800/50 border-slate-600 text-white text-xs no-drag-region",children:(0,i.jsx)(w,{placeholder:"VI"})}),(0,i.jsx)(j,{className:"bg-slate-800 border-slate-600",children:S.map(e=>(0,i.jsx)(N,{value:e.value,className:"text-white hover:bg-slate-700 text-xs",children:e.label},e.value))})]})]})})}var I=s(9588),P=s(5273),D=s(8934);function E(e){let{value:t,onValueChange:s,placeholder:a="Select audio device",className:r="",disabled:l=!1,open:o,onOpenChange:d}=e,[c,u]=(0,n.useState)([]),[h,g]=(0,n.useState)(!0),[m,x]=(0,n.useState)(null),[p,v]=(0,n.useState)(!1),[f,A]=(0,n.useState)(!1);(0,n.useEffect)(()=>{k();let e=()=>{k()};return navigator.mediaDevices.addEventListener("devicechange",e),()=>{navigator.mediaDevices.removeEventListener("devicechange",e)}},[]);let k=async()=>{try{g(!0),x(null),await D.audioDeviceManager.enumerateDevices();let n=D.audioDeviceManager.getCategorizedDevices();if(u(n),!t&&n.length>0){var e,i;let t=null===(e=n.find(e=>"output"===e.type))||void 0===e?void 0:e.devices[0],a=null===(i=n.find(e=>"input"===e.type))||void 0===i?void 0:i.devices[0];t?s(t.deviceId):a&&s(a.deviceId)}}catch(e){x("Failed to load audio devices"),console.error("Error loading audio devices:",e)}finally{g(!1)}},S=e=>"input"===e?(0,i.jsx)(I.A,{className:"w-3 h-3 mr-2 text-slate-400"}):(0,i.jsx)(P.A,{className:"w-3 h-3 mr-2 text-slate-400"});return m?(0,i.jsxs)("div",{className:"flex items-center justify-between p-2 bg-red-900/20 border border-red-700/30 rounded-lg text-red-300 text-sm ".concat(r),children:[(0,i.jsx)("span",{children:m}),(0,i.jsx)("button",{onClick:k,className:"text-red-400 hover:text-red-300 transition-colors",children:"Retry"})]}):(0,i.jsxs)(b,{value:t,onValueChange:s,open:void 0!==o?o:p,onOpenChange:e=>{d?d(e):v(e)},disabled:l||h,children:[(0,i.jsx)(y,{className:"w-full h-10 bg-slate-800/50 border border-slate-600 text-white ".concat(r),children:(0,i.jsx)(w,{placeholder:h?"Loading devices...":a,children:(()=>{if(!t)return a;for(let e of c){let s=e.devices.find(e=>e.deviceId===t);if(s){if("output"===e.type)return"System Audio";return s.label}}return a})()})}),(0,i.jsx)(j,{className:"bg-slate-800 border border-slate-600 max-h-80",children:h?(0,i.jsx)("div",{className:"p-4 text-center text-slate-400",children:"Loading audio devices..."}):0===c.length?(0,i.jsx)("div",{className:"p-4 text-center text-slate-400",children:"No audio devices found"}):(0,i.jsx)(i.Fragment,{children:c.map((e,t)=>(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"px-3 py-2 text-xs font-medium text-slate-500 uppercase tracking-wider border-b border-slate-700/50",children:e.label}),e.devices.map((t,s)=>(0,i.jsx)(N,{value:t.deviceId,className:"text-white hover:bg-slate-700 focus:bg-slate-700",children:(0,i.jsxs)("div",{className:"flex items-center w-full",children:[S(e.type),(0,i.jsx)("span",{className:"truncate",children:"output"===e.type?"Capture System Audio":t.label}),"output"===e.type&&window.electronAPI&&(0,i.jsx)("span",{className:"ml-2 text-xs text-green-400",children:"(Direct)"})]})},t.deviceId)),t<c.length-1&&(0,i.jsx)("div",{className:"h-px bg-slate-700/50 my-1"})]},e.type))})})]})}function z(e){let{selectedAudioDevice:t,onAudioDeviceChange:s,openDropdown:n,setOpenDropdown:a,setPendingDropdown:r}=e;return(0,i.jsx)("div",{className:"w-[130px]",children:(0,i.jsx)(E,{value:t,onValueChange:s,placeholder:"Select audio source",className:"h-6 text-xs no-drag-region",open:"audio"===n,onOpenChange:e=>{e?r("audio"):(a(null),r(null))}})})}var L=s(9397);function T(e){let{running:t,connected:s,listening:n}=e,a=t&&s&&n?{text:"Listening",color:"text-green-400",bgColor:"bg-green-900/30",borderColor:"border-green-400"}:t&&s?{text:"Listening",color:"text-yellow-400",bgColor:"bg-yellow-900/30",borderColor:"border-yellow-400"}:t&&!s?{text:"Connecting",color:"text-yellow-400",bgColor:"bg-yellow-900/30",borderColor:"border-yellow-400"}:s?{text:"Connected",color:"text-blue-400",bgColor:"bg-blue-900/30",borderColor:"border-blue-400"}:{text:"Inactive",color:"text-slate-400",bgColor:"bg-slate-800/30",borderColor:"border-slate-600"};return(0,i.jsx)("div",{className:"flex items-center justify-center flex-shrink-0 no-drag-region",children:(0,i.jsxs)(u,{variant:"outline",size:"sm",className:"px-1.5 py-1 w-[105px] ".concat(a.borderColor," ").concat(a.color," hover:bg-slate-700 ").concat(a.bgColor," transition-all duration-200"),children:[(0,i.jsx)(L.A,{className:"w-2.5 h-2.5 mr-0.5"}),(0,i.jsx)("span",{className:"text-[10px]",children:a.text})]})})}var R=s(133),W=s(8749),M=s(381),O=s(4416);function V(e){let{showSettings:t,onToggleSettings:s,onStartOver:n,onHideWindow:a,onQuitApp:r}=e;return(0,i.jsxs)("div",{className:"flex items-center gap-1 flex-1 justify-end no-drag-region",children:[(0,i.jsxs)(u,{variant:"outline",size:"sm",className:"px-1.5 py-1 border-slate-600 text-slate-300 hover:bg-slate-700 bg-transparent transition-all duration-200",onClick:n,children:[(0,i.jsx)(R.A,{className:"w-2.5 h-2.5 mr-0.5"}),(0,i.jsx)("span",{className:"text-[10px]",children:"Start Over"})]}),(0,i.jsxs)("div",{className:"flex items-center gap-0.5",children:[(0,i.jsxs)(u,{variant:"outline",size:"sm",className:"px-1.5 py-1 border-slate-600 text-slate-300 hover:bg-slate-700 bg-transparent transition-all duration-200",onClick:a,children:[(0,i.jsx)(W.A,{className:"w-2.5 h-2.5 mr-0.5"}),(0,i.jsx)("span",{className:"text-[10px]",children:"Hide"}),(0,i.jsx)("span",{className:"text-slate-500 text-[8px] ml-0.5",children:"Win+Alt+H"})]}),(0,i.jsx)(u,{variant:"ghost",size:"sm",className:"p-1 text-slate-400 hover:text-white hover:bg-slate-700/50 rounded-lg transition-all duration-200",onClick:s,children:(0,i.jsx)(M.A,{className:"w-2.5 h-2.5"})}),(0,i.jsx)(u,{variant:"ghost",size:"sm",className:"p-1 text-slate-400 hover:text-red-400 hover:bg-red-900/20 rounded-lg transition-all duration-200",onClick:r,children:(0,i.jsx)(O.A,{className:"w-2.5 h-2.5"})})]})]})}var _=s(4835);function F(e){let{selectedAudioDevice:t,onAudioDeviceChange:s,voiceTypingKeybind:n,liveSubtitleKeybind:a,hideKeybind:r,onVoiceTypingKeybindChange:l,onLiveSubtitleKeybindChange:o,onHideKeybindChange:d,onStartOver:c}=e;return(0,i.jsx)("div",{className:"bg-slate-900/70 backdrop-blur-md border border-slate-700/30 rounded-xl shadow-2xl",children:(0,i.jsxs)("div",{className:"py-2 px-4",children:[(0,i.jsxs)("div",{className:"mb-6 flex items-center justify-between",children:[(0,i.jsxs)("h3",{className:"text-white font-semibold text-lg flex items-center",children:[(0,i.jsx)(M.A,{className:"w-5 h-5 mr-3"}),"Settings"]}),(0,i.jsxs)(u,{variant:"outline",size:"sm",className:"px-1.5 py-1 border-slate-600 text-slate-300 hover:bg-slate-700 bg-transparent transition-all duration-200",onClick:c,children:[(0,i.jsx)(_.A,{className:"w-2.5 h-2.5 mr-0.5"}),(0,i.jsx)("span",{className:"text-[10px]",children:"Start Over"})]})]}),(0,i.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[(0,i.jsxs)("div",{className:"space-y-6",children:[(0,i.jsxs)("h4",{className:"text-slate-300 font-medium flex items-center",children:[(0,i.jsx)("div",{className:"w-4 h-4 mr-2 rounded-full bg-slate-600 flex items-center justify-center",children:(0,i.jsx)("span",{className:"text-slate-300 text-xs",children:"\uD83C\uDFA4"})}),"Audio Devices"]}),(0,i.jsx)("div",{className:"space-y-4",children:(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"text-sm text-slate-400 mb-2 block",children:"Audio Source"}),(0,i.jsx)(E,{value:t,onValueChange:s,placeholder:"Select audio device",className:"w-full"})]})})]}),(0,i.jsxs)("div",{className:"space-y-6",children:[(0,i.jsxs)("h4",{className:"text-slate-300 font-medium flex items-center",children:[(0,i.jsx)("div",{className:"w-4 h-4 mr-2 rounded-full bg-slate-600 flex items-center justify-center",children:(0,i.jsx)("span",{className:"text-slate-300 text-xs",children:"⌨️"})}),"Keybinds"]}),(0,i.jsxs)("div",{className:"space-y-4",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"text-sm text-slate-400 mb-2 block",children:"Voice Typing"}),(0,i.jsx)("input",{type:"text",value:n,onChange:e=>l(e.target.value),className:"w-full h-10 px-3 bg-slate-800/50 border border-slate-600 rounded-lg text-white focus:border-blue-400 focus:outline-none transition-colors",placeholder:"Win+Alt+V"})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"text-sm text-slate-400 mb-2 block",children:"Live Subtitle"}),(0,i.jsx)("input",{type:"text",value:a,onChange:e=>o(e.target.value),className:"w-full h-10 px-3 bg-slate-800/50 border border-slate-600 rounded-lg text-white focus:border-blue-400 focus:outline-none transition-colors",placeholder:"Win+Alt+L"})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"text-sm text-slate-400 mb-2 block",children:"Hide Window"}),(0,i.jsx)("input",{type:"text",value:r,onChange:e=>d(e.target.value),className:"w-full h-10 px-3 bg-slate-800/50 border border-slate-600 rounded-lg text-white focus:border-blue-400 focus:outline-none transition-colors",placeholder:"Win+Alt+H"})]})]})]})]})]})})}let H={connect:()=>window.electronAPI.connectGateway(),disconnect:()=>window.electronAPI.disconnectGateway(),setMode:e=>window.electronAPI.setMode(e),updateLanguages:(e,t)=>window.electronAPI.updateLanguages(e,t),startOver:()=>window.electronAPI.sendStartOver()};class q{async start(){if(this.isRecording){console.warn("Audio recorder is already recording, ignoring start request");return}try{let{audioDeviceManager:e}=await Promise.resolve().then(s.bind(s,8934));if(this.mediaStream=await e.getDeviceStream(this.options.deviceId),!this.mediaStream)throw Error("Failed to get media stream from device");this.audioContext=new(window.AudioContext||window.webkitAudioContext)({sampleRate:this.options.sampleRate}),this.sourceNode=this.audioContext.createMediaStreamSource(this.mediaStream),this.scriptNode=this.audioContext.createScriptProcessor(4096,1,1),this.scriptNode.onaudioprocess=e=>{if(!this.isRecording)return;let t=e.inputBuffer.getChannelData(0);this.options.onData&&this.options.onData(t)},this.sourceNode.connect(this.scriptNode),this.scriptNode.connect(this.audioContext.destination),this.isRecording=!0,this.options.onStart&&this.options.onStart()}catch(e){throw this.options.onError&&this.options.onError(e),e}}async stop(){this.isRecording&&(this.isRecording=!1,this.scriptNode&&(this.scriptNode.disconnect(),this.scriptNode.onaudioprocess=null,this.scriptNode=null),this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=null),this.mediaStream&&(this.mediaStream.getTracks().forEach(e=>e.stop()),this.mediaStream=null),this.audioContext&&(await this.audioContext.close(),this.audioContext=null),await new Promise(e=>setTimeout(e,100)),this.options.onStop&&this.options.onStop())}isActive(){return this.isRecording}static float32ToInt16(e){let t=new Int16Array(e.length);for(let s=0;s<e.length;s++){let i=Math.max(-1,Math.min(1,e[s]));t[s]=i<0?32768*i:32767*i}return t}static int16ToFloat32(e){let t=new Float32Array(e.length);for(let s=0;s<e.length;s++)t[s]=e[s]/32767;return t}static getAudioLevel(e){let t=0;for(let s=0;s<e.length;s++)t+=e[s]*e[s];return Math.min(1,10*Math.sqrt(t/e.length))}constructor(e){this.mediaStream=null,this.audioContext=null,this.sourceNode=null,this.scriptNode=null,this.isRecording=!1,this.options={sampleRate:16e3,channels:1,...e}}}function G(){let[e,t]=(0,n.useState)("en"),[s,a]=(0,n.useState)("vi"),[r,l]=(0,n.useState)("Win+Alt+V"),[o,d]=(0,n.useState)("Win+Alt+L"),[c,u]=(0,n.useState)("Win+Alt+H"),[h,g]=(0,n.useState)(null),[x,p]=(0,n.useState)(""),[v,f]=(0,n.useState)(null),[b,w]=(0,n.useState)(null),{connected:y,connecting:j,mode:N,connect:A,disconnect:k,setMode:S}=function(){let[e,t]=(0,n.useState)(!1),[s,i]=(0,n.useState)(!1),[a,r]=(0,n.useState)("typing");(0,n.useEffect)(()=>(window.electronAPI.onConnectionStatus((e,s)=>{t(s.connected),i(!1)}),()=>{window.electronAPI.removeAllListeners("connection-status")}),[]);let l=async()=>{if(e)return{success:!0};if(s)return{success:!1,error:"Already connecting"};i(!0);try{return await H.connect()}catch(e){return i(!1),{success:!1,error:e instanceof Error?e.message:"Connection failed"}}},o=async()=>{e&&await H.disconnect()};return{connected:e,connecting:s,mode:a,connect:l,disconnect:o,setMode:async e=>{let t=await H.setMode(e);return t.success&&r(e),t}}}(),{isRecording:I,audioLevel:P,selectedDevice:E,setSelectedDevice:L,startRecording:R,stopRecording:W}=function(){let[e,t]=(0,n.useState)(!1),[s,i]=(0,n.useState)(0),[a,r]=(0,n.useState)(""),[l,o]=(0,n.useState)(null),d=(0,n.useRef)(!1);(0,n.useEffect)(()=>{d.current=e},[e]);let c=(0,n.useCallback)(async()=>{if(!a||e)return!1;try{if(l&&(await l.stop(),o(null)),!await D.audioDeviceManager.getDeviceStream(a))return!1;let e=new q({deviceId:a,sampleRate:16e3,channels:1,onData:t=>{let s=q.getAudioLevel(t);i(s);let n=q.float32ToInt16(t),a=new Uint8Array(n.buffer.slice(0));if(window.electronAPI){if(!d.current)return;let t=(null==e?void 0:e.getSampleRate)?e.getSampleRate():16e3;window.electronAPI.sendAudioChunk?window.electronAPI.sendAudioChunk(a,t||16e3):window.electronAPI.sendAudioData(a,t||16e3)}},onError:e=>{console.error("Audio recording error:",e),t(!1),i(0)},onStart:()=>{t(!0)},onStop:()=>{t(!1),i(0)}});return await e.start(),o(e),!0}catch(e){return console.error("Failed to start audio recording:",e),t(!1),i(0),!1}},[a,e,l]),u=(0,n.useCallback)(async()=>{l&&(await l.stop(),o(null))},[l]);return(0,n.useEffect)(()=>()=>{l&&l.stop()},[l]),{isRecording:e,audioLevel:s,selectedDevice:a,setSelectedDevice:r,startRecording:c,stopRecording:u}}(),{rootRef:M,toolbarRef:O,settingsRef:_,showSettings:G,toggleSettings:K}=function(e,t){let[s,i]=(0,n.useState)({toolbar:0,settings:0}),[a,r]=(0,n.useState)(!1),l=(0,n.useRef)(null),o=(0,n.useRef)(null),d=(0,n.useRef)(null),c=(0,n.useRef)({width:0,height:0}),u=(0,n.useRef)(null);return(0,n.useEffect)(()=>{let e=[{ref:o,key:"toolbar"},{ref:d,key:"settings"}].map(e=>{let{ref:t,key:s}=e;if(!t.current)return null;let n=new ResizeObserver(e=>{if(e[0]){let t=Math.ceil(e[0].target.getBoundingClientRect().height);i(e=>e[s]!==t?{...e,[s]:t}:e)}});return n.observe(t.current),n}).filter(Boolean);return()=>{e.forEach(e=>e.disconnect())}},[]),(0,n.useEffect)(()=>{if(!l.current)return;let e=new ResizeObserver(e=>{if(e[0]){let t=Math.ceil(e[0].contentRect.width);if(window.electronAPI&&t>0&&t!==c.current.width){if(c.current.width=t,0===c.current.height){let e=s.toolbar;c.current.height=e}window.electronAPI.setWindowSize({width:c.current.width,height:c.current.height})}}});return e.observe(l.current),()=>e.disconnect()},[s.toolbar]),(0,n.useEffect)(()=>{if(a);else{let e=setTimeout(()=>{},500);return()=>clearTimeout(e)}},[a]),(0,n.useEffect)(()=>{if(0===c.current.width||0===s.toolbar)return;let{toolbar:i,settings:n}=s,r=i;a&&(r+=16,r+=n),(e||t)&&("audio"===e||"audio"===t?r+=300:r+=150);let l=c.current.height;if(r===l)return;let o=r>l,d=c.current.width;u.current&&clearTimeout(u.current);let h=()=>{window.electronAPI&&window.electronAPI.setWindowSize({width:d,height:r}),c.current.height=r};return o?h():u.current=setTimeout(h,500),()=>{u.current&&clearTimeout(u.current)}},[a,s,e,t]),{rootRef:l,toolbarRef:o,settingsRef:d,showSettings:a,toggleSettings:()=>r(!a)}}(v,b);(0,n.useEffect)(()=>{if(b&&null===v){let e=setTimeout(()=>{f(b),w(null)},100);return()=>clearTimeout(e)}},[b,v]);let U=y&&"typing"===N&&I,$=y&&"subtitle"===N&&I,B=I&&y,Q=async e=>{if(!E){g("Please select an audio device first");return}if("typing"===e?U:$)await W(),await k();else{g(null);let t=await A();if(!t.success){g(t.error||"Failed to connect to gateway");return}let s=await S(e);if(!s.success){g(s.error||"Failed to set mode"),await k();return}await R()||(g("Failed to start audio recording"),await k())}};!function(e){let t=(0,n.useRef)(!1);(0,n.useEffect)(()=>{let s=async(s,i)=>{if(!t.current){t.current=!0;try{e(i)}finally{setTimeout(()=>{t.current=!1},100)}}};return window.electronAPI&&window.electronAPI.onGlobalShortcut(s),()=>{window.electronAPI&&window.electronAPI.removeAllListeners("global-shortcut")}},[e])}(async e=>{switch(e){case"toggle-voice-typing":case"voice-typing":if(!E)return;if("system-audio"===E){window.electronAPI.showNotification("⚠️ Sorry!","This shortcut can't be used while capturing system audio. Please click the button on screen to start instead."),window.electronAPI.showWindow();return}await Q("typing");break;case"toggle-live-subtitle":case"live-subtitle":if(!E)return;if("system-audio"===E){window.electronAPI.showNotification("⚠️ Sorry!","This shortcut can't be used while capturing system audio. Please click the button on screen to start instead."),window.electronAPI.showWindow();return}await Q("subtitle");break;case"hide-window":window.electronAPI.hideWindow();break;case"show-window":window.electronAPI.showWindow()}}),(0,n.useEffect)(()=>{y&&H.updateLanguages(e,s)},[e,s,y]),(0,n.useEffect)(()=>(window.electronAPI.onRealtimeResult((t,i)=>{if($){let t=i.text||"",n=i.translation||"";e!==s?window.electronAPI.updateDualSubtitle({transcription:t,translation:n}):window.electronAPI.updateSubtitle(n||t)}}),window.electronAPI.onLiveTranscriptionUpdate((e,t)=>{p(t.translation||t.text||"")}),()=>{window.electronAPI.removeAllListeners("realtime-result"),window.electronAPI.removeAllListeners("live-transcription-update")}),[$,e,s]);let Z=async()=>{g(null),p(""),await W(),await k(),await H.startOver()};return(0,i.jsxs)("div",{ref:M,className:"dynamic-container",style:{background:"transparent",width:"1050px",height:"max-content",margin:0,padding:0},id:"nova-root",children:[(0,i.jsx)("div",{ref:O,className:"flex justify-center",children:(0,i.jsx)("div",{className:"bg-slate-900/70 backdrop-blur-md border border-slate-700/30 rounded-2xl shadow-2xl w-full drag-region",children:(0,i.jsxs)("div",{className:"flex items-center justify-between py-2 pl-4 pr-2 gap-2",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)(m,{voiceTypingActive:U,liveSubtitleActive:$,onToggleVoiceTyping:()=>Q("typing"),onToggleLiveSubtitle:()=>Q("subtitle")}),(0,i.jsx)(C,{sourceLanguage:e,targetLanguage:s,onSourceLanguageChange:t,onTargetLanguageChange:a,openDropdown:v,setOpenDropdown:f,setPendingDropdown:w}),(0,i.jsx)(z,{selectedAudioDevice:E,onAudioDeviceChange:L,openDropdown:v,setOpenDropdown:f,setPendingDropdown:w})]}),(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)(T,{running:I,connected:y,listening:B}),(0,i.jsx)(V,{showSettings:G,onToggleSettings:K,onStartOver:Z,onHideWindow:()=>window.electronAPI.hideWindow(),onQuitApp:()=>window.electronAPI.quitApp()})]})]})})}),h&&(0,i.jsx)("div",{className:"fixed top-4 left-4 right-4 bg-red-900/90 backdrop-blur-md border border-red-700/50 rounded-xl p-4 shadow-2xl z-50",children:(0,i.jsxs)("div",{className:"flex items-center gap-3",children:[(0,i.jsx)("div",{className:"flex-shrink-0",children:(0,i.jsx)("div",{className:"w-5 h-5 bg-red-500 rounded-full flex items-center justify-center",children:(0,i.jsx)("span",{className:"text-white text-xs",children:"⚠"})})}),(0,i.jsxs)("div",{className:"flex-1",children:[(0,i.jsx)("p",{className:"text-red-200 text-sm font-medium",children:"Connection Error"}),(0,i.jsx)("p",{className:"text-red-300 text-xs mt-1",children:h})]}),(0,i.jsx)("button",{onClick:()=>g(null),className:"text-red-400 hover:text-red-300 transition-colors",children:"\xd7"})]})}),(0,i.jsx)("div",{className:"flex flex-col items-center justify-start ".concat(G?"pt-2 pb-2":""),id:"nova-content",children:(0,i.jsx)("div",{className:"w-full max-w-7xl",children:(0,i.jsx)("div",{className:"grid transition-all duration-500 ease-out",style:{gridTemplateRows:G?"1fr":"0fr"},children:(0,i.jsx)("div",{className:"overflow-hidden",children:(0,i.jsx)("div",{ref:_,children:(0,i.jsx)(F,{selectedAudioDevice:E,onAudioDeviceChange:L,voiceTypingKeybind:r,liveSubtitleKeybind:o,hideKeybind:c,onVoiceTypingKeybindChange:l,onLiveSubtitleKeybindChange:d,onHideKeybindChange:u,onStartOver:Z})})})})})})]})}},8782:(e,t,s)=>{Promise.resolve().then(s.bind(s,2164))},8934:(e,t,s)=>{"use strict";s.d(t,{audioDeviceManager:()=>n});class i{static getInstance(){return i.instance||(i.instance=new i),i.instance}async requestPermission(){try{return(await navigator.mediaDevices.getUserMedia({audio:!0})).getTracks().forEach(e=>e.stop()),this.permissionGranted=!0,!0}catch(e){return console.error("Failed to get audio permission:",e),this.permissionGranted=!1,!1}}async enumerateDevices(){if(!this.permissionGranted&&!await this.requestPermission())return[];try{let e=await navigator.mediaDevices.enumerateDevices();return this.devices=e.filter(e=>"audioinput"===e.kind||"audiooutput"===e.kind).map(e=>({deviceId:e.deviceId,label:this.cleanDeviceLabel(e.label)||this.getDefaultDeviceName(e.kind,e.deviceId),kind:e.kind,groupId:e.groupId})).filter(e=>{let t=e.label.toLowerCase(),s=e.deviceId.toLowerCase();return"audioinput"===e.kind?!(t.includes("virtual")||t.includes("cable")||t.includes("loopback")||t.includes("null")||t.includes("dummy")||t.includes("blackhole")||t.includes("vb-audio")||t.includes("voicemeeter")||t.includes("obs")||t.includes("streamlabs")||t.includes("xsplit")||t.includes("discord")||t.includes("zoom")||t.includes("teams")||t.includes("skype")||t.includes("slack")||t.includes("webex")||t.includes("gotomeeting")||t.includes("microsoft teams")||t.includes("google meet")||t.includes("audio repeater")||t.includes("che volume")||t.includes("jack router")||t.includes("asio")||t.includes("asio4all")||t.includes("soundflower")||t.includes("screencast")||t.includes("line in")||t.includes("wave in")||t.includes("microphone (")&&(t.includes("high definition")||t.includes("realtek")||t.includes("conexant")||t.includes("intel")||t.includes("nvidia")||t.includes("amd"))||"microphone"===t&&s.length<10||t.includes("input")&&!t.includes("microphone")||/^\d+$/.test(s)||s.startsWith("default")||s.startsWith("communications")):!(t.includes("virtual")||t.includes("cable")||t.includes("loopback")||t.includes("null")||t.includes("dummy")||t.includes("blackhole")||t.includes("vb-audio")||t.includes("voicemeeter")||t.includes("obs")||t.includes("streamlabs")||t.includes("xsplit"))}),this.devices}catch(e){return console.error("Failed to enumerate audio devices:",e),[]}}getCategorizedDevices(){let e=this.devices.filter(e=>"audioinput"===e.kind),t=this.devices.filter(e=>"audiooutput"===e.kind),s=[];return t.length>0&&s.push({type:"output",label:"System Audio",devices:[{deviceId:"system-audio",label:"Capture System Audio",kind:"audiooutput"}]}),e.length>0&&s.push({type:"input",label:"Input Devices",devices:e}),s}async getDeviceStream(e){try{if("system-audio"===e){if(i.systemAudioCaptureInProgress)throw console.warn("System audio capture already in progress, ignoring request"),Error("Audio source is currently busy. Please wait a moment and try again.");i.systemAudioCaptureInProgress=!0;try{console.log("Requesting system audio capture...");let e=await navigator.mediaDevices.getDisplayMedia({video:{frameRate:1},audio:!0});if(!e.getAudioTracks||0===e.getAudioTracks().length)throw e.getVideoTracks().forEach(e=>e.stop()),Error("No system audio track available on this OS");return console.log("System audio capture successful"),e}finally{i.systemAudioCaptureInProgress=!1}}let t=this.devices.find(t=>t.deviceId===e);if(!t)return console.error("Device not found:",e),null;if("audioinput"===t.kind)return await navigator.mediaDevices.getUserMedia({audio:{deviceId:{exact:e},echoCancellation:!1,noiseSuppression:!1,autoGainControl:!1}});throw Error("Unsupported device type for capture")}catch(t){console.error("Failed to get device stream:",t);let e=t instanceof Error?t.message:String(t);if(e.includes("Could not start audio source"))throw Error("Audio source is currently busy. Please wait a moment and try again.");if(e.includes("Permission denied"))throw Error("Audio permission denied. Please allow microphone access.");if(e.includes("NotAllowedError"))throw Error("Audio access was denied. Please check your browser permissions.");throw t}}getDefaultDeviceName(e,t){return"audioinput"===e?"Microphone ".concat(t.slice(-4)):"Speaker ".concat(t.slice(-4))}cleanDeviceLabel(e){let t=e;return(t=(t=(t=t.replace(/\s*\([0-9a-f]{4}:[0-9a-f]{4}\)$/i,"")).replace(/\s*\([0-9a-f]{2}(?::|-)[0-9a-f]{2}(?::|-)[0-9a-f]{2}(?::|-)[0-9a-f]{2}(?::|-)[0-9a-f]{2}(?::|-)[0-9a-f]{2}\)$/i,"")).replace(/\s*\(\s*\)$/g,"")).trim()}getDeviceInfo(e){return"system-audio"===e?{deviceId:"system-audio",label:"Capture System Audio",kind:"audiooutput"}:this.devices.find(t=>t.deviceId===e)||null}async detectSystemAudioDevices(){let e=await this.enumerateDevices(),t=["monitor","loopback","stereo mix","what u hear","wave out mix","system audio","desktop audio","speakers","headphones"];return e.filter(e=>{let s=e.label.toLowerCase();return t.some(e=>s.includes(e))})}async getDefaultInputDevice(){let e=this.devices.filter(e=>"audioinput"===e.kind);return 0===e.length?null:e.find(e=>{let t=e.label.toLowerCase();return t.includes("default")||t.includes("primary")||t.includes("built-in")||t.includes("internal")})||e[0]}async getDefaultOutputDevice(){let e=this.devices.filter(e=>"audiooutput"===e.kind);return 0===e.length?null:e.find(e=>{let t=e.label.toLowerCase();return t.includes("default")||t.includes("primary")||t.includes("built-in")||t.includes("internal")||t.includes("speakers")})||e[0]}constructor(){this.devices=[],this.permissionGranted=!1}}i.systemAudioCaptureInProgress=!1;let n=i.getInstance()}},e=>{var t=t=>e(e.s=t);e.O(0,[581,441,684,358],()=>t(8782)),_N_E=e.O()}]);